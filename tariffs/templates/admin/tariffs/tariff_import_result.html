{% extends "admin/base_site.html" %}
{% load i18n %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
  &rsaquo; <a href="{% url 'admin:tariffs_tariff_changelist' %}">Tariffs</a>
  &rsaquo; Import Results
</div>
{% endblock %}

{% block content %}
<h1>YAML Import Results</h1>

{% if results.created %}
<div class="module">
  <h2>Successfully Created ({{ results.created|length }})</h2>
  <table>
    <thead>
      <tr>
        <th>Tariff Name</th>
        <th>Utility</th>
        <th>Energy Charges</th>
        <th>Demand Charges</th>
        <th>Customer Charges</th>
      </tr>
    </thead>
    <tbody>
      {% for tariff, counts in results.created %}
      <tr>
        <td><a href="{% url 'admin:tariffs_tariff_change' tariff.pk %}">{{ tariff.name }}</a></td>
        <td>{{ tariff.utility.name }}</td>
        <td>{{ counts.energy }}</td>
        <td>{{ counts.demand }}</td>
        <td>{{ counts.customer }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% if results.updated %}
<div class="module">
  <h2>Successfully Updated ({{ results.updated|length }})</h2>
  <table>
    <thead>
      <tr>
        <th>Tariff Name</th>
        <th>Utility</th>
        <th>Energy Charges</th>
        <th>Demand Charges</th>
        <th>Customer Charges</th>
      </tr>
    </thead>
    <tbody>
      {% for tariff, counts in results.updated %}
      <tr>
        <td><a href="{% url 'admin:tariffs_tariff_change' tariff.pk %}">{{ tariff.name }}</a></td>
        <td>{{ tariff.utility.name }}</td>
        <td>{{ counts.energy }}</td>
        <td>{{ counts.demand }}</td>
        <td>{{ counts.customer }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% if results.skipped %}
<div class="module">
  <h2 class="warning">Skipped ({{ results.skipped|length }})</h2>
  <p>The following tariffs already exist and were skipped (replace_existing was not checked):</p>
  <table>
    <thead>
      <tr>
        <th>Tariff Name</th>
        <th>Reason</th>
      </tr>
    </thead>
    <tbody>
      {% for tariff_name, reason in results.skipped %}
      <tr>
        <td>{{ tariff_name }}</td>
        <td>{{ reason }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

{% if results.errors %}
<div class="module">
  <h2 class="errornote">Errors ({{ results.errors|length }})</h2>
  <p>The following tariffs could not be imported:</p>
  {% for tariff_name, error_messages in results.errors %}
  <div class="errors">
    <h3>{{ tariff_name }}</h3>
    <ul>
      {% for error in error_messages %}
      <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endfor %}
</div>
{% endif %}

<div class="submit-row">
  <a href="{% url 'admin:tariffs_tariff_changelist' %}" class="button default">Back to Tariff List</a>
  <a href="{% url 'admin:tariffs_tariff_import' %}" class="button">Import Another File</a>
</div>

<style>
.warning {
  color: #ba6900;
}
.module table {
  width: 100%;
  margin-top: 10px;
}
.module table th {
  text-align: left;
  background: #f8f8f8;
  padding: 8px;
  border-bottom: 1px solid #ddd;
}
.module table td {
  padding: 8px;
  border-bottom: 1px solid #eee;
}
</style>
{% endblock %}
